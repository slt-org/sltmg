<!DOCTYPE html>
<html>
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <!-- Bootstrap CSS -->
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <script src="https://unpkg.com/mathjs@10.6.0/lib/browser/math.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat&display=swap');


        body {
            font-family: 'Montserrat', sans-serif;
            color: #333;
            background: white;
        }

        form {
            background: white;
        }

        label {
            margin-bottom: .5rem;
            text-align: right;
            display: block;
            letter-spacing: 2px;
            color: #adb5bd;
            text-transform: uppercase;
        }

        .form-control {
            border: none;
            background: none;
            border-bottom: 2px solid rgba(0, 0, 0, 0.2);
            transition: border-color .4s ease-out;
            border-radius: 0;
        }

        .form-control:active,
        .form-control:focus,
        .btn.focus,
        .btn:focus {
            outline: none;
            box-shadow: none;
            border-color: black;
        }

        .form-control.valid {
            border-color: green;
        }

        .form-control.invalid {
            border-color: red;
        }

        .form-control + small {
            color: red;
            opacity: 0;
            height: 0;
            transition: opacity .4s ease-out;
        }

        .form-control.invalid + small {
            opacity: 1;
            height: auto;
            margin-bottom: 20px;
            transition: opacity .4s ease-out;
        }

        .btn {
            border: 2px solid black;
            padding: 0.175rem 1.75rem;
            text-transform: uppercase;
            font-weight: 900;
            border-radius: 9px;
        }

        .btn:hover {
            color: white;
            background: black;
            transition: all .4s ease-out;
        }

        .standard {
            background:  #f0f4ef;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-8">
            <form class="row g-3" id="myForm" onsubmit="handleFormSubmit()">
                <p class="h4 sm-4 text-center">Slab Volume</p>
                <br>
                <p>
                    <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                        help
                    </button>
                </p>
                <div class="collapse" id="collapseExample">
                    <p>Calculate a Volume in cubic units for a defined shape.
                        In our case we have slabs/blocks.</p>
                    <div class="card card-body">
                        <small id="hint" class="form-text">acceptable values are any numbers whole, decimals or
                            fractions
                            <br> e.g. 3, 0.3, 3.6, 6 1/4 & 1/2
                            <br> be aware! 1 1/4 and 11/4 are not the same!</small>
                    </div>
                    <div>
                        <br>
                        <a href="https://sites.google.com/view/slt-mg/resources/documentation#h.cbsta86jkoi8" class="btn btn-primary btn-sm" role="button" aria-disabled="true">Slab Volume documentation</a>
                    </div>
                </div>
                <div class="form-row align-items-center">
                    <div class="col-sm-auto">
                        <div class="form-group input-group">
                            <input type="text" class="form-control" id="length" placeholder="length" required>
                            <select class="form-select-sm" id="lengthInputUnits">
                                <option value="in" selected>in</option>
                                <option value="mm">mm</option>
                                <option value="cm">cm</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-auto">
                        <div class="form-group input-group">
                            <input type="text" class="form-control" id="width" placeholder="width" required>
                            <select class="form-select-sm" id="widthInputUnits">
                                <option value="in" selected>in</option>
                                <option value="mm">mm</option>
                                <option value="cm">cm</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-auto">
                        <div class="form-group input-group">
                            <input type="text" class="form-control" id="height" placeholder="height" required>
                            <select class="form-select-sm" id="heightInputUnits">
                                <option value="in" selected>in</option>
                                <option value="mm">mm</option>
                                <option value="cm">cm</option>
                            </select>
                        </div>
                    </div>
                    <br>
                    <div class="form-group col-sm-6">
                        <p class="h6 sm-4 ">Volume output units</p><!-- todo change to iDiskVolume-->

                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="output" id="metric" value="metric"
                                   checked>
                            <label class="form-check-label" for="metric">Metric</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="output" id="imperial" value="imperial">
                            <label class="form-check-label" for="imperial">Imperial</label>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <button type="submit" class="btn btn-primary btn-sm">Volume</button>
                </div>
            </form>
            <br>
            <div class="col-sm-auto" id="recipe">
                <h6><b>Volume of Slab:</b> 0 cm<sup>3</sup></h6>
                <div class="standard">
                    <p>Use this value as input to <a href="https://sites.google.com/view/slt-mg/mg-recipe-generators/custom">Custom</a>
                    to generate a Modeling Glass recipe.
                    </p>...
                </div>
                <p>
                <h6>Weight of Standard glass for this volume -  0 g</h6>
                <p>
            </div>
        </div>
    </div>
    <br>
    <div id="ver"><p>GlassToolbox ver. 1.4</p></div>
</div>
<!-- Option 1: Bootstrap Bundle with Popper -->
<script crossorigin="anonymous"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- 1. Constants -->
<script>
    const GLASS = .614;
    const WATER = .326;
    const BINDER = .032;
    const LMEDIUM = .027;
    const GLASS96 = .579;
    const WATER96 = .359;
    const BINDER96 = .036;
    const LMEDIUM96 = .026;
    const CUBICCM = 'cm<sup>3</sup>';
    const PI = 3.1416;
    const GLASSCONV = 0.232;
    const WATERCONV = 0.236;
    const BINDERCONV = 0.416;
    const LMEDIUMCONV = 0.2;
    const CUP = "cup";
    const a3QTR = "3/4";
    const aHALF = "1/2";
    const a1QTR = "1/4"
    const TBSP = "tbsp";
    const TSP = "tsp";
    const IMPERIAL = "imperial";
    const METRIC = "metric";
    const CITOCC = 16.387;
    const INTOCM = 2.54;
    const OZTOGM = 28.3495;
    const AUTHOR = "Steve Terry";
    const VERSION = "1.2";
    const REL = "candidate";
</script>
<!-- 2. validation for input fields -->
<script>
    const inputs = document.querySelectorAll('input');

    const patterns = {
        length: /^[0-9]+[,.]?[0-9]*([\/][0-9]+[,.]?[0-9]*)*/,
        width: /^[0-9]+[,.]?[0-9]*([\/][0-9]+[,.]?[0-9]*)*/,
        height: /^[0-9]+[,.]?[0-9]*([\/][0-9]+[,.]?[0-9]*)*/
    };

    inputs.forEach((input) => {
        input.addEventListener('keyup', (e) => {
            validate(e.target, patterns[e.target.attributes.id.value]);
        });
    });

    /**
     * This validation framework could enhanced to do more complex validation
     * this could include checking the to see if the value fell into a range
     * we define. It could possibly be applied to numbers. Walk the debugger
     * to see how it works.
     */
    function validate(field, regex) {
        if (regex.test(field.value)) {
            field.className = 'form-control valid';
        } else {
            field.className = 'form-control invalid';
        }
    }
</script>
<!-- 3. Initial input handling different for each page-->
<script>
    /**
     * Slab page specific code for
     * * Initial input handling with form submit
     * * Calculations by Shape Slab object
     * takes the form input values and turns
     * them into normalized metric numbers and output unit preferences1
     * @type {Slab}
     */
    function slabInputCollector() {
        console.log("in slabInputCollector ***************************");
        let data = new Object();
        data.length = document.querySelector('#length').value;
        let selectLengthUnits = document.getElementById('lengthInputUnits');
        data.lengthUnits = selectLengthUnits.options[selectLengthUnits.selectedIndex].value;

        data.width = document.querySelector('#width').value;
        let selectWidthUnits = document.getElementById('widthInputUnits');
        data.widthUnits = selectWidthUnits.options[selectWidthUnits.selectedIndex].value;

        data.height = document.querySelector('#height').value;
        let selectHeightUnits = document.getElementById('heightInputUnits');
        data.heightUnits = selectHeightUnits.options[selectHeightUnits.selectedIndex].value;

        data.outputUnits = document.querySelector('input[name=output]:checked').value;
        console.log("out slabInputCollector ***************************");

        return data;
    }

    class Slab {
        length;
        lengthUnits;
        width;
        widthUnits;
        height;
        heightUnits;
        volume;
        volumeUnits;
        weight;
        weightUnits;
        weightStdGlass;
        outputUnits;

        constructor(data) {
            this.length = data.length;
            this.lengthUnits = data.lengthUnits;
            this.width = data.width;
            this.widthUnits = data.widthUnits;
            this.height = data.height;
            this.heightUnits = data.heightUnits;
            this.outputUnits = data.outputUnits;
        };

        /**
         * turns all units of measurement into centimeters.
         */
        normalizeUnits() {
            console.log("in Slab.normalize ***************************");
            // turn all values that might be fractions into numbers.
            let _length = math.number(math.fraction(this.length));
            let _width = math.number(math.fraction(this.width));
            let _height = math.number(math.fraction(this.height));
            this.length = this.convertToMetric(_length,this.lengthUnits);
            this.lengthUnits = "cm";
            this.width = this.convertToMetric(_width,this.widthUnits);
            this.widthUnits = "cm";
            this.height = this.convertToMetric(_height,this.heightUnits);
            this.heightUnits = "cm";
            console.log("out Slab.normalize ***************************");
            return "todo";
        };

        /**
         * calculate volume from dimensions.
         */
        calculateVolume(){
            this.volume = (this.length * this.width * this.height).toFixed(2);
            // MG weight not Std. BE glass weight
            this.weight = (this.volume * 2).toFixed(2);
            this.weightUnits = "g";
            this.weightStdGlass = (this.volume * 2.5).toFixed(2);
            // volume here is always in cm^3
            this.volumeUnits = "cm<sup>3</sup>"
            // volume here is always in cm^3
        }

        /**
         * turns all units of measurement into centimeters.
         */
        convertToMetric(value, units) {
            switch (units) {
                case "in": {
                    // convert to cm
                    value = (value * INTOCM).toFixed(3);
                    break;
                }
                case "mm": {
                    // convert to cm
                    value = (value / 10).toFixed(3);
                    break;
                }
                default: {
                    // no conversion necessary do nothing and return the value
                }
            }
            return value;
        };

        /**
         * All calculations are done so return the display html
         * @return {string} resultHtml
         */

        getOutput() {
            console.log("in Slab:getRecipe:*******************");
            let resultHtml;

            if (this.outputUnits == "metric") {
                // we need to do nothing but call generateHtml with "this"
                resultHtml = this.generateHtml(this);
            } else if (this.outputUnits == "imperial") {
                let imperial = this.convertToImperial();
                // convert the metric units to imperial units
                resultHtml = this.generateHtml(imperial);
            } else {
                cosole.log("We should never get here 'Big old Error'");
                resultHtml = "<h3>Failed to create recipe...  ERROR</h3>";
            }
            console.log("out  Slab:getRecipe:*******************");
            return resultHtml;
        };

        convertToImperial() {
            console.log("in  SlabVolume:convertToImperial:*******************");
            let imperial = new Object();
            imperial.length=(this.length / INTOCM).toFixed(3);
            imperial.lengthUnits="in";
            imperial.width=(this.width / INTOCM).toFixed(3);
            imperial.widthUnits="in";
            imperial.height=(this.height / INTOCM).toFixed(3);
            imperial.heightUnits="in";
            imperial.volume=(this.volume / CITOCC).toFixed(3);
            imperial.volumeUnits="in<sup>3</sup>";
            imperial.weight=(this.weight / OZTOGM).toFixed(3);
            imperial.weightUnits="oz";
            imperial.weightStdGlass=(this.weightStdGlass / OZTOGM).toFixed(2)
            imperial.outputUnits=this.outputUnits;

            console.log("out  SlavVolume:convertToImperial:*******************");
            return imperial;
        }

        generateHtml(outObject){
            console.log("in  DiskVolume:generateHtml:*******************");
            let tmplt =
                "<h6><b>Volume of Slab: </b>"+outObject.volume+" "+outObject.volumeUnits+"</h6>\n" +
                "<div class=\"standard\">\n" +
                "  <p>Use this value as input to <a href=\"https://sites.google.com/view/slt-mg/mg-recipe-generators/custom\">Custom</a>\n" +
                "  to generate a Modeling Glass recipe.\n" +
                "  </p>\n" +
                "  <p>\n" +
                "  <h6>Weight of Standard glass for this volume -  "+outObject.weightStdGlass+" "+outObject.weightUnits+"</h6>\n" +
                "  <p>\n" +
                "  </div>\n";
            console.log("out  DiskVolume:generateHtml:*******************");
            return tmplt;
        }

    }

    function handleFormSubmit() {
        console.log("*************** in handleFormSubmit ");
        // inputs are valid
        // page specific function here for gathering named inputs, units and output units
        let updateLocation = document.querySelector('#recipe');

        let slab = new Slab(slabInputCollector());
        slab.normalizeUnits();
        slab.calculateVolume();

        let generatedRecipe = slab.getOutput();
        updateLocation.innerHTML = generatedRecipe;

        console.log("*************** out handleFormSubmit ");
    }

    // the last line of page specific code in the script.
    // All the code from this point on is common to all pages.

    function preventFormSubmit() {
        let forms = document.querySelectorAll('form');
        for (let i = 0; i < forms.length; i++) {
            forms[i].addEventListener('submit', function (event) {
                event.preventDefault();
            });
        }
    }

    window.addEventListener('load', preventFormSubmit);

</script>

</body>
</html>